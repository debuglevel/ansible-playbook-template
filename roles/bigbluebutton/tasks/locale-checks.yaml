- name: Ensure language-pack-en is installed
  become: true
  apt:
    name: language-pack-en
  tags:
    - installation

- name: Update locale
  become: true
  command: update-locale LANG=en_US.UTF-8
  tags:
    - configuration

- name: Check that 'LANG=en_US.UTF-8' is in /etc/default/locale
  lineinfile:
    name: /etc/default/locale
    line: "LANG=en_US.UTF-8"
    # regexp: "LANG=.*en_US.UTF-8" # Does not work instead of "line"; no idea why.
    state: present
  check_mode: true
  register: conf
  failed_when: (conf is changed) or (conf is failed)
  changed_when: False # Never report that this task has changed anything
  tags:
    - check

- name: Check that 'LC_ALL' is not in /etc/default/locale
  lineinfile:
    name: /etc/default/locale
    line: "LC_ALL"
    state: absent
  check_mode: true
  register: conf
  failed_when: (conf is changed) or (conf is failed)
  changed_when: False
  tags:
    - check

- name: Set 'LANG=en_US.UTF-8' for systemd environment
  become: true
  shell: systemctl set-environment LANG=en_US.UTF-8
  tags:
    - configuration

- name: Check 'en_US.UTF-8' is in systemd environment
  shell: systemctl show-environment | grep LANG=en_US.UTF-8
  ignore_errors: false
  changed_when: False
  tags:
    - check
